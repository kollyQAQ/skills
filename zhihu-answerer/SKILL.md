---
name: zhihu-answerer
description: 在知乎网站自动化撰写并提交回答。用于基于已有知乎账号登录态（Cookie）打开问题页并发布回答；若用户已回答同一问题则自动进入编辑回答并替换为新内容后重新发布；若正文含淘宝/京东商品链接则自动尝试插入商品卡片，无法匹配时跳过该链接且不保留原始 URL 文本。
---

# Zhihu Answerer

## 输入要求

要求用户提供以下最小信息：
- 目标问题 URL（`https://www.zhihu.com/question/...`）
- 回答正文（Markdown 或纯文本）
- 模式：`draft`（保存草稿）或 `publish`（直接发布）
- Cookie 字符串（至少包含登录态相关 cookie）
- 可选：商品链接列表（淘宝/京东等）

优先让用户提供完整 `Cookie` 请求头字符串；不要要求账号密码。

## 执行流程

1. 将用户 Cookie 写入临时环境变量，不落盘。
2. 运行 `scripts/post_answer_playwright.js`，传入 URL、内容和模式。
3. 先做登录态检查：访问知乎首页并确认用户菜单可见。
4. 打开目标问题页，等待“写回答”入口可交互。
5. 进入编辑器，使用新正文整体替换已有内容。
6. 从正文自动提取淘宝/京东商品链接并从正文中移除 URL 文本。
7. 若有商品链接，点击“收益”入口，进入收益 iframe 面板，执行“好物推荐 -> 选渠道 -> 粘贴链接 -> 商品行添加 -> 编辑商品确定”。
8. 若模式为 `draft`，点击“保存草稿”；若模式为 `publish`，点击“提交修改/发布”并校验 `POST /api/v4/content/publish` 成功。
9. 若某商品链接无法匹配商品卡，则跳过该链接并继续；不得把该链接 URL 留在正文中。
10. 输出执行结果（成功/失败、页面标题、最终 URL、发布校验状态、插卡跳过原因）。

## 失败处理

- 若检测到未登录或 cookie 失效，立即停止并提示用户更新 Cookie。
- 若按钮文案或 DOM 结构变化，截图并打印可用按钮文本，提示更新选择器。
- 若发布失败，至少保留已写入编辑器内容并尝试保存草稿。
- 若商品链接未匹配到卡片，记录跳过原因并继续发布。
- 若开启商品卡发布，正文少于 200 可见字符时直接报错并停止，避免误判成功。

## 安全要求

- 不在日志中打印完整 Cookie。
- 不将 Cookie 写入仓库文件。
- 默认 `draft` 模式优先，只有用户明确要求时才 `publish`。

## 参考文件

- Cookie 字段建议：`references/cookie-format.md`
- 运行示例：`references/runbook.md`
